
# 详细设计文档

## 项目概述
“LipidWise”是一个微信小程序，旨在评估用户的ASCVD风险，并提供个性化的健康建议。

## 系统架构设计
### 概述:
“LipidWise”微信小程序将采用微信云开发平台，该平台提供了数据库、云函数、文件存储等服务，允许无服务器(serverless)架构的实现。这样，我们可以专注于前端的开发，同时确保后端逻辑的高效性和可扩展性。
### 前端（微信小程序）:
* 负责与用户直接交互的用户界面(UI)。
* 提供数据输入、数据展示、用户指导等功能。
* 通过微信提供的API与后端云函数通信。
### 后端（云函数）:
* 实现核心的业务逻辑，如风险评估算法和健康建议生成。
* 处理对云数据库的CRUD操作（创建、读取、更新、删除）。
* 处理用户身份验证和数据加密。
### 数据库（微信云数据库）:
* 存储用户个人信息、健康数据和评估结果。
* 支持数据的查询和更新操作。
* 确保数据的安全性和隐私性。
### 第三方服务:
* 如果需要，可以集成如微信支付、地图等微信提供的其他服务。
### 数据流向:
* 用户在小程序中输入个人健康数据。
* 前端将数据发送到云函数。
* 云函数处理数据，并将处理结果存储到云数据库。
* 云函数将评估结果返回前端展示。
### 通信协议:
* 使用HTTPS协议保证数据在小程序和云函数间的安全传输。
* 数据交换格式为JSON，轻量且易于前后端解析。
### 安全考虑:
* 小程序的用户认证通过微信身份验证完成，确保用户身份的可信。
* 使用微信云开发的安全规则来限制和管理对云数据库的访问权限。
* 通过云函数对用户输入的数据进行验证和清洗，预防SQL注入等安全威胁。
### 性能与监控:
* 云函数的执行时间和内存使用情况将被监控，确保性能标准的达成。
* 使用微信云开发的监控工具跟踪小程序的运行情况，如访问量、响应时间等。
### 用户体验:
* 确保小程序的加载时间和页面响应时间符合用户期望。
* 对于复杂的计算或数据处理，给予用户明确的加载提示。
### 维护策略:
* 小程序和云函数的代码需要定期更新和维护，以修复已知问题和满足新的用户需求。
* 云数据库的结构设计需要预留一定的灵活性，以适应未来可能的功能扩展。

## 用户界面设计
1. **首页**：简洁的入口和指向各主要功能的导航。
首页布局建议：
头部（Top Bar）：应用程序的Logo。“LipidWise”标题。可能的用户图标或登录按钮。
导航（Navigation）：快速入口按钮，如“开始评估”、“健康资讯”、“我的记录”等。
主要内容区域（Main Content Area）：简短介绍文本或动态滚动的健康小贴士。引导用户进行风险评估的视觉元素，比如一个大的“开始”按钮。
底部（Footer）：常用链接或信息，如“关于我们”、“帮助”、“反馈”。

2. **信息输入页**：表单形式收集用户健康数据。
表单布局：清晰的指示文本，例如“请填写您的健康信息”。分类的表单输入字段，例如个人信息、健康数据等。
输入字段：文本框、选择器和滑动条来输入各种健康指标。带有标签和占位符的输入框，引导用户了解所需信息。
操作按钮：明显的“提交”或“下一步”按钮。
提示与帮助：提供输入信息的提示或帮助图标。

3. **结果展示页**：清晰展示风险评估结果和健康建议。
结果摘要：显示评估结果的简短文本，例如“您的ASCVD风险评分为：低/中/高”。视觉突出的风险级别显示。
健康建议区域：根据风险评分提供的个性化健康建议。
包括生活方式和饮食建议的详细列表。
分享和记录：选项让用户可以保存结果或分享到社交媒体。

## 数据库设计
### 用户信息集合 (users):
* userId (String): 用户唯一标识，由微信提供。
* name (String): 用户姓名，由用户输入。
* age (Integer): 用户年龄，由用户输入。
* gender (String): 用户性别，由用户选择。
* smokingStatus (Boolean): 吸烟状态，由用户选择。
* healthData (Object): 包含收缩压、胆固醇等健康数据的对象。
* systolicBP (Integer): 收缩压值。
* totalCholesterol (Float): 总胆固醇值。
* hdl (Float): 高密度脂蛋白胆固醇值。
* ldl (Float): 低密度脂蛋白胆固醇值。
* triglycerides (Float): 甘油三酯值。
### 评估结果集合
* userId (String): 关联到users集合的用户唯一标识。
* assessmentDate (Timestamp): 评估进行的时间。
* riskScore (Float): 风险评分，由云函数计算得出。
* riskCategory (String): 风险等级，根据风险评分确定。
* recommendations (Array of Strings): 根据风险等级推荐的健康建议。
### 安全规则
* 读写权限应该严格限制，只允许经过身份验证的用户读取或写入与他们相关的数据。
* 对于users集合，用户只能读取和写入自己的文档。
* 对于assessments集合，用户只能读取自己的评估结果。
### 性能考虑
* 对于经常被查询的字段，比如userId和assessmentDate，建立索引以提高查询效率。
* 定期评估和优化查询模式，以降低不必要的数据读写操作和成本。
### 数据备份和恢复策略
* 定期进行数据备份，确保在意外情况下可以恢复数据。
* 制定数据恢复计划，以应对数据丢失或损坏的情况。
### 数据隐私和合规
* 确保存储的数据符合适用的数据保护法规，比如中国的网络安全法。
* 在用户删除帐户时，提供一种机制来删除与用户相关的所有数据。

## 详细设计
### 云函数设计:
#### calculateRisk:
* 输入: 用户健康数据（年龄、性别、吸烟状况、血压、胆固醇等）。
* 处理: 应用ASCVD风险评估算法来计算风险得分。
* 输出: 风险得分及风险等级（低、中、高）。
#### generateRecommendations:
* 输入: 风险得分及风险等级。
* 处理: 根据风险等级选择对应的健康建议。
* 输出: 一组针对用户的个性化健康建议。

### 风险评估算法逻辑:
* 使用从用户数据计算得出的关键健康指标，如LDL-C和收缩压。
* 根据《中国血脂管理指南（2023年）》中的表格，结合用户年龄、性别、吸烟状况等，评估ASCVD风险。
* 使用条件语句和数学公式执行算法，计算出风险分数。
* 将分数映射到风险等级，例如：if (score < 10) { riskCategory = 'Low'; } else if (score < 20) { riskCategory = 'Medium'; } else { riskCategory = 'High'; }

### 健康建议生成逻辑:
* 确定一系列的预防措施，如饮食建议、运动计划、生活方式调整建议。
* 根据用户风险等级，从预设的建议库中选择适当的建议。
* 如果需要，可添加进一步的医疗跟进或医生咨询推荐。

## 安全设计
### 用户认证和授权:
* 利用微信小程序提供的认证机制，确保每个请求都来自于经过认证的用户。
* 通过云函数来控制用户对数据的访问，确保用户只能访问自己的数据。
### 数据存储安全:
* 数据在传输过程中使用SSL/TLS加密，确保数据的安全性。
* 云数据库的访问控制通过安全规则来实施，限制未授权的数据访问。
### 错误处理和日志记录:
* 云函数内部实现错误捕获和处理逻辑，确保系统的健壮性。
* 使用日志记录机制，记录关键操作和错误事件，以便问题追踪和调试。
### 测试策略
#### 单元测试:
* 对云函数中的每个逻辑单元，编写测试用例进行验证。
* 使用模拟的用户数据来测试风险评估算法的准确性。
#### 集成测试:
* 测试小程序的前端与后端的云函数集成是否顺畅。
* 验证整个风险评估流程，确保从数据输入到结果展示的正确性。
#### 性能测试:
* 测试云函数在高负载下的响应时间和稳定性。
* 确定云数据库能够处理大量的并发请求。

## 用户体验(UX)设计
### 交互设计:
* 设计直观的用户流程，确保用户可以轻松完成风险评估并获取健康建议。
* 提供清晰的指示和反馈，确保用户在每个步骤知道如何操作以及期望发生的事情。
### 视觉设计:
* 使用微信小程序的设计语言来确保用户界面(UI)与用户的期望一致。
* 设计适合小程序环境的图标和元素，考虑到可读性和点击区域的大小。
### 无障碍:
* 考虑到色盲用户和视觉障碍用户，设计高对比度的颜色方案和可调节大小的文字。
### 反馈机制:
* 提供一种机制供用户反馈使用体验，可以是简单的调查问卷或反馈表单。

## 管理和监控
### 日志记录:
* 在云函数中实现详细的日志记录机制，对关键操作和潜在错误进行记录。
### 性能监控:
* 使用微信小程序管理工具或第三方服务来监控小程序的性能指标，例如启动时间、响应时间和错误率。
### 用户行为分析:
* 分析用户行为数据来了解用户如何与小程序互动，哪些功能最受欢迎，以及可能的痛点。

## 测试策略
### 用户测试:
* 在内部团队或小范围的用户群体中进行用户测试，以收集初步反馈。
* 根据用户反馈调整UI/UX设计。
### 系统测试:
* 测试小程序的所有功能是否按照预期工作，包括用户界面和后端逻辑的集成测试。

## 部署和维护计划
### 部署流程:
* 设置持续集成/持续部署(CI/CD)流程，以自动化代码到测试环境和生产环境的部署。
### 更新和维护:
* 制定定期更新计划，包括新功能的添加和现有功能的优化。
* 监控小程序的运行状况，并制定快速响应机制以处理用户反馈和错误。
### 数据备份:
* 制定数据备份计划，确保在数据丢失或损坏时能够迅速恢复。

以上为详细设计文档的初稿，基于对项目需求和功能规格的理解。如果有任何需要调整或补充的地方，请告知。
